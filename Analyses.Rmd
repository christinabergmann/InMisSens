---
title: "MP MetaAnalysis"
author: "Christina Bergmann"
output: 
  pdf_document:
    toc: true
---
```{r Setup, echo = FALSE, warning=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, tidy = TRUE, message = FALSE, error = TRUE)

### Load libraries
library(tidyverse)
library(metafor)
library(meta)
library(pwr)
library(knitr)
library(wesanderson)

```

#Preparation

Read in data and tidy up dataset

```{r ReadIn,  echo = FALSE}
#Get the data
source("scripts/calculateES.R")

```

```{r Preprocess, echo = FALSE}

db_ET <- db_ET %>%
  mutate(age.C = (mean_age_1-mean(mean_age_1, na.rm=TRUE))/30.44) %>%
  filter(mean_age_months < 31)


db_ET$collapse <- paste(db_ET$study_ID, db_ET$expt_num, db_ET$same_infant, sep = "_")

#Split into correct and MP database

db_ET_correct <- db_ET[db_ET$is_correct=="1",]
db_ET_MP <- db_ET[db_ET$is_mp=="1",]

#collapse over nonindependent MP rows for a *general* MP effect


collapse_rows <- function(db){
  db$collapse <- paste(db$study_ID, db$expt_num, db$same_infant, sep = "_")
  
  for(independent in unique(db$collapse)){
    if(length(db[db$collapse==independent])>1){
      sub = db[db$collapse==independent, ]
      sub$d_calc <- median(sub$d_calc)
      sub$d_var_calc <- median(sub$d_var_calc)
      sub$g_calc <- median(sub$g_calc)
      sub$g_var_calc <- median(sub$g_var_calc)
      sub$corr_imputed <- median(sub$corr_imputed)
      db <- db[!(db$collapse==independent),]
      db <- rbind(db, sub[1,])
    }
  }
  return(db)
}


#db_ET_correct = collapse_rows(db_ET_correct)

#db_ET_MP = collapse_rows(db_ET_MP)

#remove outliers, for now we have none, though
db_ET_MP$nooutlier = ifelse(db_ET_MP$g_calc > mean(db_ET_MP$g_calc, na.rm = TRUE) + 3*sd(db_ET_MP$g_calc, na.rm = TRUE) 
                         | db_ET_MP$g_calc < mean(db_ET_MP$g_calc, na.rm = TRUE) - 3*sd(db_ET_MP$g_calc, na.rm = TRUE),FALSE, TRUE)
db_ET_MP = db_ET_MP[db_ET_MP$nooutlier,]

db_ET_correct$nooutlier = ifelse(db_ET_correct$g_calc > mean(db_ET_correct$g_calc, na.rm = TRUE) + 3*sd(db_ET_correct$g_calc, na.rm = TRUE) 
                         | db_ET_correct$g_calc < mean(db_ET_correct$g_calc, na.rm = TRUE) - 3*sd(db_ET_correct$g_calc, na.rm = TRUE),FALSE, TRUE)
db_ET_correct = db_ET_correct[db_ET_correct$nooutlier,]


# make sure that both correct and mispronounced conditions are considered in descriptives

db_ET_correct$condition <- 1
db_ET_MP$condition <- 0

dat <- bind_rows(db_ET_correct, db_ET_MP)

# need data set of unique short cite by expt_num
# in order to calculate total number of infants

# need data set of unique short cite by condition

sum_dat <- dat[!duplicated(dat[c("short_cite", "same_infant")]),]
time_wind_dat <- dat[!duplicated(dat[c("short_cite", "offset", "post_nam_dur")]),]

```

# Descriptive data

The database contains data from `r length(unique(dat$short_cite))` papers consisting of data from `r sum(sum_dat$n_1)` infants. In the tables below, we provide more descriptive information.

The next table shows what type of publications were included in our meta-analysis
```{r DescriptivesPubtype, echo = FALSE}

pub_info <- dat %>%
  group_by(publication_status) %>%
  summarize(n_unique = n_distinct(short_cite), count = n())

kable(pub_info)

```

The table below shows based on which data we calculated effect sizes.

```{r DescriptivesES, echo = FALSE}
#how did we calculate effect sizes?

es_info <- dat %>%
  group_by(es_method) %>%
  summarize(n_unique = n_distinct(short_cite), count = n())

kable(es_info)
#table(dat$es_method, dat$short_cite)
# only missing from:
# Bailey & Plunkett (2002) <- crazy old data
# Renner (2017) <- just finished phd
# Tamasi (2016) <- standard deviations are wrong
#table(db_ET_MP$es_method)

```

We also have different ways of comparison of the time-course data, as the next table shows.
```{r DescriptivesComparison, echo = FALSE}
db_ET_correct$within_measure_descriptive <- ifelse(db_ET_correct$within_measure == "post",
 "post-naming phase compared with chance (=50%)",
ifelse(db_ET_correct$within_measure == "pre_post", "post-naming compared to pre-naming phase", "post-pre difference score compared with chance (=0)"))


comparison_info <- db_ET_correct %>%
  group_by(within_measure_descriptive) %>%
  summarize(n_unique = n_distinct(short_cite), count = n())


kable(comparison_info)
#table(db_ET_MP$es_method)
```


## Analysis time window

Where possible, we noted the time window for analysis. First, let's look at the offset (in milliseconds) after the start of the word, i.e. the begin of a give analysis window for a naming effect

```{r TimeWindowOffset}
offset_info <- time_wind_dat %>%
  group_by(offset) %>%
  summarize(count = n())


kable(offset_info)

```

Next we look at duration (in seconds) of the post naming window, here,too, we see a lot of heterogeneity.

```{r TimeWindowduration}
duration_info <- db_ET_correct %>%
  group_by(post_nam_dur) %>%
  summarize(count = n())


kable(duration_info)

```

In summary, we see little consistency in analysis methods of comparable studies looking at naming and mispronunciation effects. 


## Early Ages
Even the youngest ages in the database (less than 1 year) show mispronunciation sensitivity

```{r YoungAge, echo = FALSE}
youngest <- subset(dat, min_age_1 < 365)

unique(youngest$short_cite)
youngest$cond_lab <- ifelse(youngest$condition == 1, "correct", "misp")
ggplot(youngest, aes(x=cond_lab, y = g_calc, color = cond_lab)) + geom_boxplot()

```


# Meta-Analysis

## Correct object identification effect

```{r MAcorrect}

rma_correct = rma.mv(g_calc, g_var_calc, data = db_ET_correct, random = ~ collapse | short_cite)

summary(rma_correct)

rma_correct_age = rma.mv(g_calc, g_var_calc, mods = ~age.C, data = db_ET_correct, random = ~ collapse | short_cite)

summary(rma_correct_age)

```

## Mispronunciation object identification effect

```{r MAMP}

rma_MP = rma.mv(g_calc, g_var_calc, data = db_ET_MP, random = ~ collapse | short_cite)

summary(rma_MP)


rma_MP_age = rma.mv(g_calc, g_var_calc, mods = ~age.C, data = db_ET_MP, random = ~ collapse | short_cite)

summary(rma_MP_age)
```

## Mispronunciation effect
```{r MPEffect}
db_ET_correct$condition <- 1
db_ET_MP$condition <- 0

dat <- bind_rows(db_ET_correct, db_ET_MP)
  
rma_MPeffect <- rma.mv(g_calc, g_var_calc, mods = ~condition, data = dat, random = ~ collapse | short_cite)
  
summary(rma_MPeffect)  

rma_MPeffect_1 <- rma.mv(g_calc, g_var_calc, mods = ~condition-1, data = dat, random = ~ collapse | short_cite)
  
summary(rma_MPeffect_1)  


rma_MPeffect_age <- rma.mv(g_calc, g_var_calc, mods = ~age.C*condition, data = dat, random = ~ collapse | short_cite)
  
summary(rma_MPeffect_age)  


```


### Language effect

Followup: Per condition (correct or MP) the interaction with age

```{r LanguageEffectAnalyses}
dat$condition_label = ifelse(dat$condition==1, "Correct", "Misp")

dat$lang_family = ifelse(dat$native_lang=="American English" | dat$native_lang=="British English" |
                           dat$native_lang=="Dutch" | dat$native_lang=="English" | 
                           dat$native_lang=="Danish" | dat$native_lang=="Swedish" |
                           dat$native_lang=="German", "Germanic",
                         ifelse(dat$native_lang == "French" | dat$native_lang == "Catalan" |
                                  dat$native_lang == "Spanish" | dat$native_lang == "Catalan-Spanish" |
                                  dat$native_lang == "Swiss French", "Romanic", "Sino-Tibetian"))

rma_lang_interaction <- rma.mv(g_calc, g_var_calc, mods = ~age.C*condition*lang_family, data = dat, random = ~ collapse | short_cite)
summary(rma_lang_interaction)
```


### Type of distractor


```{r DistractorType}

rma_DistractorAge <- rma.mv(g_calc, g_var_calc, mods = ~age.C*condition*as.factor(object_pair), data = dat, random = ~ collapse | short_cite)
  
summary(rma_DistractorAge)  

```

#### Subset to same age range


```{r DistractorTypeAge}

min_age <- min(dat[dat$object_pair=="familiar_novel",]$mean_age_1)
max_age <- max(dat[dat$object_pair=="familiar_novel",]$mean_age_1)

dat_age= dat%>%
  filter(mean_age_1>min_age&mean_age_1<max_age)

rma_DistractorAgeS <- rma.mv(g_calc, g_var_calc, mods = ~age.C*condition*as.factor(object_pair), data = dat_age, random = ~ collapse | short_cite)
  
summary(rma_DistractorAgeS)  

```




### Distractor Overlap


```{r DistractorOverlap}

rma_DistractorOverlap <- rma.mv(g_calc, g_var_calc, mods = ~age.C*distractor_overlap, data = db_ET_MP, random = ~ collapse | short_cite)
  
summary(rma_DistractorOverlap)  

```








## Number of features

```{r NFeatures}

db_ET_MPf = db_ET_MP %>%
  filter(n_feature != "1-3" & n_feature != "1-2" & n_feature != "2-3")

#rma_NFeatures <- rma.mv(g_calc, g_var_calc, mods = ~as.ordered(n_feature), data = db_ET_MP, random = ~collapse | short_cite)
rma_NFeatures <- rma.mv(g_calc, g_var_calc, mods = ~as.factor(n_feature), data = db_ET_MPf, random = ~collapse | short_cite)
 
 
summary(rma_NFeatures)


rma_NFeaturesAge <- rma.mv(g_calc, g_var_calc, mods = ~as.factor(n_feature)*age.C, data = db_ET_MPf, random = ~collapse | short_cite)
 
 
summary(rma_NFeaturesAge)
```



### Interaction with condition

```{r NFeaturesCondition}

dat_f <- subset(dat, n_feature == "0" | n_feature == "1" |
                n_feature == "2" | n_feature == "3")

#rma_NFeatures <- rma.mv(g_calc, g_var_calc, mods = ~as.ordered(n_feature), data = db_ET_MP, random = ~collapse | short_cite)
rma_NFeatures <- rma.mv(g_calc, g_var_calc, mods = ~as.factor(n_feature)*condition, data = dat_f, random = ~collapse | short_cite)
 
 
summary(rma_NFeatures)


rma_NFeaturesAge <- rma.mv(g_calc, g_var_calc, mods = ~as.factor(n_feature)*age.C*condition, data = dat_f, random = ~collapse | short_cite)
 
 
summary(rma_NFeaturesAge)
```









## MP location

```{r Location}
#table(db_ET_MP$mispron_location)

db_ET_MPl = db_ET_MP %>%
  filter(mispron_location == "onset"  | mispron_location == "medial")

#rma_NFeatures <- rma.mv(g_calc, g_var_calc, mods = ~as.ordered(n_feature), data = db_ET_MP, random = ~collapse | short_cite)
rma_Location <- rma.mv(g_calc, g_var_calc, mods = ~mispron_location, data = db_ET_MPl, random = ~collapse | short_cite)
 
 
summary(rma_Location)


rma_LocationAge <- rma.mv(g_calc, g_var_calc, mods = ~mispron_location*age.C, data = db_ET_MPl, random = ~collapse | short_cite)
 
 
summary(rma_LocationAge)
```


## MP type: Vowel, consonant, or tone?


```{r MPtype}
db_MP_type <- subset(db_ET_MP, type_feature == "consonant" | type_feature == "vowel" )



rma_TypeFeaturesMP <- rma.mv(g_calc, g_var_calc, mods = ~type_feature, data = db_MP_type, random = ~collapse | short_cite)
 
 
summary(rma_TypeFeaturesMP)


rma_TypeFeaturesMPAge <- rma.mv(g_calc, g_var_calc, mods = ~type_feature*age.C, data = db_MP_type, random = ~collapse | short_cite)
 
 
summary(rma_TypeFeaturesMPAge)
```


### Interaction with condition
```{r MPtypeCondition}
dat_type <- subset(dat, type_feature == "consonant" | type_feature == "vowel" |
                type_feature == "tone")
dat_type$type_feature <- as.factor(ifelse(dat_type$condition == 1, "none", dat_type$type_feature))


rma_TypeFeatures <- rma.mv(g_calc, g_var_calc, mods = ~relevel(type_feature, "none")*condition, data = dat_type, random = ~collapse | short_cite)
 
 
summary(rma_TypeFeatures)


rma_TypeFeaturesAge <- rma.mv(g_calc, g_var_calc, mods = ~relevel(type_feature, "none")*age.C*condition, data = dat_type, random = ~collapse | short_cite)
 
 
summary(rma_TypeFeaturesAge)
```

### Interaction with language
```{r MPtypeLanguage}
#dat_type <- subset(dat, type_feature == "consonant" | type_feature == "vowel" |
#                type_feature == "tone")

dat_type <- subset(dat, type_feature == "consonant" | type_feature == "vowel")

dat_type$type_feature <- as.factor(ifelse(dat_type$condition == 1, "none", dat_type$type_feature))

dat_type$lang_family = ifelse(dat_type$native_lang=="American English" | dat_type$native_lang=="British English" | dat_type$native_lang=="Dutch" |
dat_type$native_lang=="Danish" | dat_type$native_lang=="Swedish" |
dat_type$native_lang=="English" | dat_type$native_lang=="German", "Germanic", ifelse(dat_type$native_lang == "French" | dat_type$native_lang == "Catalan" | dat_type$native_lang == "Spanish" | dat_type$native_lang == "Catalan-Spanish" | dat_type$native_lang == "Swiss French", 
                                "Romanic", "Sino-Tibetian"))

dat_type_sub <- subset(dat_type, lang_family != "Sino-Tibetian")

rma_TypeFeatures_Lang <- rma.mv(g_calc, g_var_calc, mods = ~relevel(type_feature, "none")*lang_family, data = dat_type_sub, random = ~collapse | short_cite)
 

summary(rma_TypeFeatures_Lang)
```


### Interaction with condition and language
```{r MPtypeLanguageCondition}
dat_type <- subset(dat, type_feature == "consonant" | type_feature == "vowel")# |
                #type_feature == "tone")
dat_type$type_feature <- as.factor(ifelse(dat_type$condition == 1, "none", dat_type$type_feature))

dat_type$lang_family = ifelse(dat_type$native_lang=="American English" | dat_type$native_lang=="British English" | dat_type$native_lang=="Dutch" |
dat_type$native_lang=="Danish" | dat_type$native_lang=="Swedish" |
dat_type$native_lang=="English" | dat_type$native_lang=="German", "Germanic", ifelse(dat_type$native_lang == "French" | dat_type$native_lang == "Catalan" | dat_type$native_lang == "Spanish" | dat_type$native_lang == "Catalan-Spanish" | dat_type$native_lang == "Swiss French", 
                                "Romanic", "Sino-Tibetian"))

dat_type_sub <- subset(dat_type, lang_family != "Sino-Tibetian")
dat_type_sub$lang_family <- as.factor(dat_type_sub$lang_family)



rma_TypeFeatures_Lang <- rma.mv(g_calc, g_var_calc, mods = ~relevel(type_feature, "none")*lang_family*condition, data = dat_type_sub, random = ~collapse | short_cite)
 

summary(rma_TypeFeatures_Lang)

```
## Correlation MP effect and vocabulary

First, let's take a look at which vocabulary data we have available.

```{r VocabularyData}
vocab_info <- db_ET_correct %>%
  mutate(has_vocab = ifelse(!is.na(r_comprehension), "comprehension", 
                            ifelse(!is.na(r_production), "production", "none"))) %>%
  group_by(has_vocab) %>%
  summarize(count = n())
  
kable(vocab_info)

```

We have 17 correlations, roughly evenly divided between comprehension and production data. There is reason to believe that production data are different from comprehension data (the former being easier to estimate for parents in the typical questionnaire-based assessment), so we should both analyze this data separately and see whether it makes sense in a joint analysis.


```{r ComprehensionMeta}
#we're relying on the library meta function metacor
compr  <- subset(db_ET_correct, !is.na(db_ET_correct$r_comprehension) & r_comprehension > -1)

metacor(cor=r_comprehension, n=n_1, studlab = short_cite, data = compr, sm = "COR")
```

```{r ProductionMeta}
#we're relying on the library meta function metacor
prodr  <- subset(db_ET_correct, !is.na(db_ET_correct$r_production) & r_production < 1)

metacor(cor=r_production, n=n_1, studlab = short_cite, data = prodr, sm = "COR")
```



# Plotting
```{r PlotAPATheme}
#Themes and plot
apatheme=theme_bw()+
  theme(#panel.grid.major=element_blank(),
    #panel.grid.minor=element_blank(),
    #panel.border=element_blank(),
    axis.line=element_line(),
    text=element_text(family='Times', size=25))

```
## Mispronunciation Effect by Age (color)
```{r PlotMPEffect}

dat$condition_label = ifelse(dat$condition==1, "Correct", "Mispronunciation")

# Color Blind palette:
cbPalette <- c("#E69F00", "#56B4E9", "#009E73", "#F0E442", "#0072B2", "#D55E00", "#CC79A7")

p <- ggplot(dat, aes(mean_age_1/30.44, g_calc, color = condition_label)) + 
  geom_point(aes(size = weights_g),show.legend=FALSE) + 
  geom_line(y= 0, linetype="dotted") + 
  geom_smooth(method = "lm", formula = y ~ log(x), aes(weight=weights_g)) +
  scale_colour_manual(values=cbPalette)+
  apatheme +
  theme(legend.title = element_blank(),
        legend.position = "bottom") + 
  xlab("Age in months") + 
  ylab("Effect size Hedges' g")
  
p

min(dat$mean_age_1/30.44)
max(dat$mean_age_1/30.44)

#ggsave("figures/AgeEffect_log.jpg", p,height= 7,width= 6)



  jpeg(filename = "figures/AgeEffect_log.jpg", 
       width = 600, height = 400, units = "px")

  p
  
  dev.off()
  


```
## Mispronunciation Effect by Age (bw)
```{r PlotMPEffect_BW}


p <- ggplot(dat, aes(mean_age_1/30.44, g_calc, color = condition_label)) + 
  geom_point(aes(size = weights_g, shape=condition_label, color=condition_label),
             show.legend=FALSE) + 
  geom_line(y= 0, linetype="dotted") + 
  geom_smooth(method = "lm", formula = y ~ log(x), aes(weight=weights_g)) +
  scale_color_grey()+
  theme_bw()+
  theme(text = element_text(size=25),
        legend.title = element_blank(),
        legend.position = "bottom") + 
  xlab("Age in months") + 
  ylab("Effect size Hedges' g")
p

ggsave("figures/AgeEffect_log_BW.jpg", p,height= 3,width= 6)

```

## MP type: Consonant, Vowel, or Tone?
```{r PlotCVEffect}


p <- ggplot(dat, aes(mean_age_1/30.44, g_calc, color = condition_label)) + 
  geom_point(aes(size = weights_g, shape = type_feature),show.legend=FALSE) + 
  facet_grid(.~type_feature)+
  geom_line(y= 0, linetype="dotted") + 
  geom_smooth(method = "lm", formula = y ~ log(x), aes(weight=weights_g)) + 
  theme(text = element_text(size=16)) + 
  xlab("Age in months") + 
  ylab("Effect size Hedges' g")
p

ggsave("figures/AgeEffect_log_CV.jpg", p)
```

## Language Family by MP type: Consonant, Vowel, or Tone?
```{r PlotCVEffect_Lang}


p <- ggplot(dat, aes(type_feature, g_calc, color = type_feature)) + 
  geom_boxplot() + 
  facet_grid(lang_family~condition_label)+
  #geom_line(y= 0, linetype="dotted") + 
  #geom_smooth(method = "lm", formula = y ~ log(x), aes(weight=weights_g)) + 
  theme(text = element_text(size=16)) + 
  xlab("Language Family") + 
  ylab("Effect size Hedges' g")
p


ggsave("figures/LangFamily_CV.jpg", p)
```

## Number of Features
```{r PlotFeatEffect}

#dat_f <- subset(dat, n_feature == "0" | n_feature == "1" | n_feature == "2" | n_feature == "3")

p <- ggplot(dat_f, aes(mean_age_1/30.44, g_calc, color = n_feature)) + 
  geom_point(aes(size = weights_g, shape = n_feature),show.legend=FALSE) + 
  #facet_grid(.~type_feature)+
  geom_line(y= 0, linetype="dotted") + 
  geom_smooth(method = "lm", formula = y ~ log(x), aes(weight=weights_g)) + 
  theme(text = element_text(size=16)) + 
  xlab("Age in months") + 
  ylab("Effect size Hedges' g")
p

ggsave("figures/AgeEffect_log_feat.jpg", p)

```

## Position of Mispronunciation
```{r PlotPositionEffect}

dat.p <- subset(dat, mispron_location == "onset" | mispron_location == "medial" |
                mispron_location == "offset")

p <- ggplot(dat.p, aes(mean_age_1/30.44, g_calc, color = condition_label)) + 
  geom_point(aes(size = weights_g, shape = mispron_location),show.legend=FALSE) + 
  facet_grid(.~mispron_location)+
  geom_line(y= 0, linetype="dotted") + 
  geom_smooth(method = "lm", formula = y ~ log(x), aes(weight=weights_g)) + 
  theme(text = element_text(size=16)) + 
  xlab("Age in months") + 
  ylab("Effect size Hedges' g")
p

ggsave("figures/AgeEffect_log_position.jpg", p)

```

## Distractor Familiarity
```{r PlotDistFamEffect}

dat$condition_label = ifelse(dat$condition==1, "correct", "MP")
dat$dist_code <- ifelse(dat$object_pair == "familiar_familiar", "familiar", "unfamiliar")

p <- ggplot(dat, aes(mean_age_1/30.44, g_calc, color = condition_label)) + 
  geom_point(aes(size = weights_g, shape = dist_code),show.legend=FALSE) + 
  facet_grid(.~dist_code)+
  geom_line(y= 0, linetype="dotted") + 
  geom_smooth(method = "lm", formula = y ~ log(x), aes(weight=weights_g)) + 
  scale_color_manual(values=wes_palette(name="Darjeeling"))+
  theme_bw()+
  theme(text = element_text(size=25),
        legend.title = element_blank(),
        legend.position = "bottom") + 
  xlab("Age in months") + 
  ylab("Effect size Hedges' g")
p

ggsave("figures/AgeEffect_log_distractor_fam.jpg", p)

```

## Distractor Familiarity (w/o age)
```{r PlotDistFamEffect_NoAge}

dat$condition_label = ifelse(dat$condition==1, "correct", "MP")
dat$dist_code <- ifelse(dat$object_pair == "familiar_familiar", "familiar", "unfamiliar")

p <- ggplot(dat, aes(dist_code, g_calc, color = condition_label)) + 
  geom_boxplot() + 
  #geom_smooth(method = "lm", formula = y ~ log(x), aes(weight=weights_g)) + 
  scale_color_manual(values=wes_palette(name="Darjeeling"))+
  theme_bw()+
  theme(text = element_text(size=25),
        legend.title = element_blank(),
        legend.position = "bottom") + 
  xlab("Distractor Familiarity") + 
  geom_hline(yintercept = 0, linetype="dotted") + 
  ylab("Effect size Hedges' g")
p



ggsave("figures/Distractor_fam_log.jpg", p)


```

## Distractor Familiarity (w/o age, subset to age range)
```{r PlotDistFamEffect_NoAge_AgeMatch}

min_age<-min(dat[dat$object_pair=="familiar_novel",]$mean_age_1)
max_age <- max(dat[dat$object_pair=="familiar_novel",]$mean_age_1)

dat_age= dat%>%
  filter(mean_age_1>min_age&mean_age_1<max_age)

dat_age$condition_label = ifelse(dat_age$condition==1, "correct", "MP")
dat_age$dist_code <- ifelse(dat_age$object_pair == "familiar_familiar", "familiar", "unfamiliar")

p <- ggplot(dat_age, aes(dist_code, g_calc, color = condition_label)) + 
  geom_boxplot() + 
  #geom_line(y= 0, linetype="dotted") + 
  #geom_smooth(method = "lm", formula = y ~ log(x), aes(weight=weights_g)) + 
  scale_color_manual(values=wes_palette(name="Darjeeling"))+
  theme_bw()+
  theme(text = element_text(size=25),
        legend.title = element_blank(),
        legend.position = "bottom") + 
  xlab("Distractor Familiarity") + 
  ylab("Effect size Hedges' g")
p

ggsave("figures/AgeMatch_Distractor_fam_log.jpg", p)

```

## Overlap between distractor and target

```{r PlotDistOverlapEffect}


p <- ggplot(dat, aes(mean_age_1/30.44, g_calc, color = condition_label)) + 
  geom_point(aes(size = weights_g, shape = distractor_overlap),show.legend=FALSE) + 
  facet_grid(.~distractor_overlap)+
  geom_line(y= 0, linetype="dotted") + 
  geom_smooth(method = "lm", formula = y ~ log(x), aes(weight=weights_g)) + 
  theme(text = element_text(size=16)) + 
  xlab("Age in months") + 
  ylab("Effect size Hedges' g")
p

ggsave("figures/AgeEffect_log_distractor_overlap.jpg", p)

```

## Language Family
```{r PlotLanguageEffect}


dat$lang_family = ifelse(dat$native_lang=="American English" | dat$native_lang=="British English" |
                           dat$native_lang=="Dutch" | dat$native_lang=="English" | 
                           dat$native_lang=="German", "Germanic",
                         ifelse(dat$native_lang == "French" | dat$native_lang == "Catalan" |
                                  dat$native_lang == "Spanish" | dat$native_lang == "Catalan-Spanish" |
                                  dat$native_lang == "Swiss French", "Romanic", "Sino-Tibetian"))

p <- ggplot(dat, aes(mean_age_1/30.44, g_calc, color = condition_label)) + 
  geom_point(aes(size = weights_g, shape = lang_family),show.legend=FALSE) + 
  facet_grid(.~lang_family)+
  geom_line(y= 0, linetype="dotted") + 
  geom_smooth(method = "lm", formula = y ~ log(x), aes(weight=weights_g)) + 
  theme(text = element_text(size=16)) + 
  xlab("Age in months") + 
  ylab("Effect size Hedges' g")
p

ggsave("figures/AgeEffect_log_language.jpg", p)

```
